<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EsnafPro Platinum - Cadde</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { slate: { 850: '#1e293b' } } } }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s; -webkit-tap-highlight-color: transparent; }
        /* Mobil KaydÄ±rma Ä°yileÅŸtirmeleri */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .dark body { background-color: #0f172a; color: #e2e8f0; }
        .dark .bg-white { background-color: #1e293b; border-color: #334155; }
        .dark .text-slate-700 { color: #f1f5f9; }
        .dark .text-slate-600 { color: #cbd5e1; }
        .dark .bg-slate-50 { background-color: #0f172a; }
        .dark .bg-gray-50 { background-color: #020617; } 
        .dark .border-slate-200 { border-color: #334155; }
        .dark input, .dark select, .dark textarea { background-color: #334155; color: white; border-color: #475569; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen overflow-hidden flex flex-col">

    <div id="login-container" class="fixed inset-0 z-[60] bg-slate-900 flex items-center justify-center fade-in px-4">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700">
            <div class="text-center mb-8">
                <i class="fa-solid fa-gem text-5xl text-indigo-500 mb-4 animate-bounce"></i>
                <h1 class="text-2xl font-bold text-slate-800 dark:text-white tracking-wide">EsnafPro Platinum</h1>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">Mobil & MasaÃ¼stÃ¼ Uyumlu</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" id="loginUser" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-slate-700 dark:text-white focus:border-indigo-500 outline-none" placeholder="KullanÄ±cÄ± adÄ±nÄ±z">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Åžifre</label>
                    <input type="password" id="loginPass" class="w-full p-3 border rounded-lg bg-gray-50 dark:bg-slate-700 dark:text-white focus:border-indigo-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="rememberMe" class="form-checkbox text-indigo-600 rounded">
                        <span class="text-sm text-slate-600 dark:text-slate-400">Beni HatÄ±rla</span>
                    </label>
                </div>

                <button onclick="checkLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-lg shadow-lg active:scale-95 transition">
                    GiriÅŸ Yap
                </button>
                
                <div id="loginError" class="text-center text-red-500 text-sm font-bold hidden">HatalÄ± Bilgi!</div>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden h-screen flex overflow-hidden relative">
        
        <div id="mobile-overlay" onclick="toggleMenu()" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden backdrop-blur-sm transition-opacity"></div>

        <div id="sidebar" class="fixed inset-y-0 left-0 z-30 w-64 bg-slate-900 text-white flex flex-col justify-between shadow-2xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div>
                <div class="h-16 flex items-center justify-between px-4 border-b border-slate-700 bg-slate-950">
                    <div class="flex items-center">
                        <i class="fa-solid fa-gem text-xl text-cyan-400"></i>
                        <span class="ml-3 font-bold text-lg tracking-wider">EsnafPro+</span>
                    </div>
                    <button onclick="toggleMenu()" class="lg:hidden text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <nav class="mt-4 space-y-1 px-2 overflow-y-auto max-h-[calc(100vh-140px)] custom-scroll">
                    <a href="#" onclick="sayfaDegistir('dashboard')" class="nav-item bg-slate-800 text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-chart-pie w-6 text-center text-blue-400"></i> <span class="ml-3">Ã–zet Rapor</span></a>
                    <a href="#" onclick="sayfaDegistir('pos')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-cash-register w-6 text-center text-green-400"></i> <span class="ml-3">SipariÅŸ & Kasa</span></a>
                    <a href="#" onclick="sayfaDegistir('customer')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-users w-6 text-center text-indigo-400"></i> <span class="ml-3">MÃ¼ÅŸteriler</span></a>
                    <a href="#" onclick="sayfaDegistir('marketing')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-bullhorn w-6 text-center text-pink-400"></i> <span class="ml-3">Duyuru & Kampanya</span></a>
                    <a href="#" onclick="sayfaDegistir('finance')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-wallet w-6 text-center text-emerald-400"></i> <span class="ml-3">Finans & Gider</span></a>
                    <a href="#" onclick="sayfaDegistir('veresiye')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-book-open w-6 text-center text-rose-400"></i> <span class="ml-3">Veresiye Defteri</span></a>
                    <a href="#" onclick="sayfaDegistir('stock')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-boxes-stacked w-6 text-center text-amber-400"></i> <span class="ml-3">Stok & Tedarik</span></a>
                    <a href="#" onclick="sayfaDegistir('notes')" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors"><i class="fa-solid fa-clipboard w-6 text-center text-yellow-200"></i> <span class="ml-3">Pano & Notlar</span></a>
                    <a href="#" onclick="openSettings()" class="nav-item text-slate-300 hover:bg-slate-800 hover:text-white group flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors mt-2 border-t border-slate-700"><i class="fa-solid fa-gear w-6 text-center"></i> <span class="ml-3">Ayarlar</span></a>
                </nav>
            </div>
            <div class="p-4 border-t border-slate-700 bg-slate-900">
                <button onclick="toggleDarkMode()" class="w-full mb-2 bg-slate-700 text-slate-300 text-xs py-2 px-2 rounded transition hover:bg-slate-600"><i class="fa-solid fa-moon"></i> Gece Modu</button>
                <button onclick="doLogout()" class="w-full bg-red-600 hover:bg-red-700 text-white text-xs py-2 px-2 rounded transition font-bold shadow-lg"><i class="fa-solid fa-right-from-bracket"></i> Ã‡Ä±kÄ±ÅŸ</button>
            </div>
        </div>

        <div class="flex-1 flex flex-col w-full bg-gray-50 dark:bg-slate-950 transition-colors duration-300">
            <header class="bg-white dark:bg-slate-800 shadow-sm h-16 flex items-center justify-between px-4 lg:px-6 z-10 flex-shrink-0">
                <div class="flex items-center">
                    <button onclick="toggleMenu()" class="lg:hidden text-slate-600 dark:text-white mr-3 p-2 rounded hover:bg-gray-100 dark:hover:bg-slate-700">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                    <div>
                        <h2 id="pageTitle" class="text-lg font-bold text-slate-800 dark:text-white hidden md:block">Panel</h2>
                        <div id="displayBusinessName" class="text-sm font-bold text-indigo-600 md:hidden">Cadde Hot Dog</div>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div id="veresiyeAlert" class="hidden cursor-pointer bg-rose-100 dark:bg-rose-900 text-rose-600 dark:text-rose-200 px-2 py-1 rounded-full text-xs font-bold" onclick="sayfaDegistir('veresiye')"><i class="fa-solid fa-file-invoice-dollar"></i> <span class="hidden md:inline">Alacak</span></div>
                    <div id="stockAlert" class="hidden cursor-pointer bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-200 px-2 py-1 rounded-full text-xs font-bold animate-pulse" onclick="sayfaDegistir('stock')"><i class="fa-solid fa-triangle-exclamation"></i> <span class="hidden md:inline">Stok</span></div>
                    <div class="text-right hidden md:block">
                        <div id="displayBusinessNameDesk" class="text-sm font-bold text-slate-900 dark:text-white">Cadde Hot Dog</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400">Platinum Panel</div>
                    </div>
                    <div class="h-9 w-9 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center text-indigo-600 dark:text-indigo-300 font-bold border border-indigo-200 dark:border-indigo-700">Y</div>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 lg:p-6 pb-20">
                
                <div id="page-dashboard" class="space-y-6 fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 relative overflow-hidden">
                            <div class="absolute right-0 top-0 h-full w-1 bg-green-500"></div>
                            <p class="text-xs font-bold text-slate-400 uppercase">BugÃ¼nkÃ¼ Ciro</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1" id="statDailyRevenue">0 â‚º</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 relative overflow-hidden">
                            <div class="absolute right-0 top-0 h-full w-1 bg-red-500"></div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Paket SipariÅŸ</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1" id="statDeliveryCount">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 relative overflow-hidden">
                            <div class="absolute right-0 top-0 h-full w-1 bg-orange-500"></div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Aktif Masalar</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1" id="statActiveTables">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 relative overflow-hidden">
                            <div class="absolute right-0 top-0 h-full w-1 bg-indigo-500"></div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Toplam MÃ¼ÅŸteri</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1" id="statTotalCustomers">0</h3>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200">
                            <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center"><h3 class="font-bold text-slate-700">Son Ä°ÅŸlemler</h3><span class="text-xs text-slate-400">CanlÄ±</span></div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-slate-600">
                                    <thead class="bg-slate-50 text-xs uppercase"><tr><th class="px-4 py-3">Saat</th><th class="px-4 py-3">TÃ¼r</th><th class="px-4 py-3">Tutar</th></tr></thead>
                                    <tbody id="dashboardSalesTable" class="divide-y divide-slate-100"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col">
                            <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-700">ðŸ“Œ Pano</h3><button onclick="sayfaDegistir('notes')" class="text-xs text-indigo-500 font-bold hover:underline">Git</button></div>
                            <div id="dashNotes" class="flex-1 space-y-2 overflow-y-auto max-h-64"><p class="text-xs text-slate-400 italic">HenÃ¼z not yok.</p></div>
                        </div>
                    </div>
                </div>

                <div id="page-pos" class="hidden h-full fade-in pb-20">
                    <div class="flex flex-col lg:flex-row gap-4 h-full">
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-64 lg:h-auto flex-shrink-0">
                            <div class="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
                                <h3 class="font-bold text-slate-700">Masalar</h3>
                                <button onclick="openSettings()" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded"><i class="fa-solid fa-plus"></i></button>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4"><div id="tablesGrid" class="grid grid-cols-3 gap-2"></div></div>
                        </div>
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col opacity-50 pointer-events-none h-80 lg:h-auto flex-shrink-0" id="productSection">
                            <div class="p-4 border-b bg-slate-50 rounded-t-xl"><h3 class="font-bold text-slate-700" id="selectedTableName">Masa SeÃ§iniz</h3></div>
                            <div class="flex-1 overflow-y-auto p-4">
                                <input type="text" id="searchProduct" onkeyup="filterProducts()" placeholder="ÃœrÃ¼n Ara..." class="w-full mb-3 p-2 text-sm border rounded bg-transparent">
                                <div id="productsGrid" class="grid grid-cols-2 gap-2"></div>
                            </div>
                        </div>
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col opacity-50 pointer-events-none h-auto flex-shrink-0 mb-10" id="orderSection">
                            <div class="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between"><h3 class="font-bold text-slate-700">Adisyon</h3><button onclick="clearCurrentOrder()" class="text-red-500 text-xs font-bold">TEMÄ°ZLE</button></div>
                            <div class="flex-1 overflow-y-auto p-4 min-h-[150px]"><ul id="currentOrderList" class="space-y-2"></ul></div>
                            <div class="p-4 bg-slate-50 border-t rounded-b-xl">
                                <div class="flex justify-between mb-4"><span class="text-slate-500">Toplam</span><span class="text-2xl font-bold text-slate-800" id="orderTotal">0.00 â‚º</span></div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="completePayment('Nakit')" class="bg-green-600 text-white py-3 rounded font-bold shadow text-xs">NAKÄ°T</button>
                                    <button onclick="completePayment('Kredi KartÄ±')" class="bg-indigo-600 text-white py-3 rounded font-bold shadow text-xs">POS</button>
                                    <button onclick="addVeresiye()" class="bg-rose-500 text-white py-3 rounded font-bold shadow text-xs">VERESÄ°YE</button>
                                    <button onclick="sendToKitchen()" class="bg-blue-500 text-white py-3 rounded font-bold shadow text-xs">MUTFAK</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-customer" class="hidden space-y-6 fade-in pb-20">
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-200"><h3 class="font-bold text-slate-700"><i class="fa-solid fa-star text-yellow-500 mr-2"></i>Puan YÃ¼kle</h3></div>
                        <div class="p-6">
                            <div class="flex flex-col gap-4">
                                <input type="text" id="mainName" placeholder="MÃ¼ÅŸteri AdÄ± (Opsiyonel)" class="w-full p-4 rounded-xl bg-gray-50 border-2">
                                <div class="relative">
                                    <span class="absolute left-4 top-4 text-gray-400 font-bold text-xl">+90</span>
                                    <input type="tel" id="mainInput" placeholder="5XX..." maxlength="10" class="w-full pl-16 pr-4 py-4 rounded-xl bg-gray-50 border-2 font-bold text-xl">
                                </div>
                                <button onclick="islemYap()" class="bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2">
                                    <i class="fa-brands fa-whatsapp text-2xl"></i> Puan Ver & Mesaj At
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-2">
                            <h3 class="font-bold text-slate-700">MÃ¼ÅŸteri Listesi</h3>
                            <input type="text" id="customerSearch" onkeyup="renderCustomerTable()" placeholder="Ara..." class="border p-2 rounded text-sm w-full md:w-64 bg-transparent">
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm text-slate-600">
                                <thead class="bg-slate-50 text-xs uppercase"><tr><th class="px-4 py-3">Ä°sim</th><th class="px-4 py-3">Tel</th><th class="px-4 py-3">Puan</th><th class="px-4 py-3 text-right">Ä°ÅŸlem</th></tr></thead>
                                <tbody id="transactionTable" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="page-marketing" class="hidden h-full fade-in pb-20">
                    <div class="flex flex-col lg:flex-row gap-6 h-full">
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-96 lg:h-auto">
                            <div class="p-4 border-b bg-slate-50 rounded-t-xl">
                                <h3 class="font-bold text-slate-700">1. AlÄ±cÄ± SeÃ§imi</h3>
                                <input type="text" id="marketingSearch" onkeyup="renderMarketingList()" placeholder="Ara..." class="w-full mt-2 p-2 border rounded text-xs bg-white">
                            </div>
                            <div id="marketingCustomerList" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
                        </div>
                        <div class="lg:w-2/3 flex flex-col gap-6">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex-1 flex flex-col">
                                <h3 class="font-bold text-slate-700 mb-2">2. Duyuru GÃ¶nder</h3>
                                <div class="flex-1 flex flex-col gap-4">
                                    <input type="text" id="targetCustomerDisplay" class="w-full p-2 bg-white border-2 border-indigo-100 rounded font-bold" placeholder="Numara">
                                    <textarea id="marketingMsgArea" class="w-full h-32 lg:h-full p-4 border rounded-lg bg-gray-50 resize-none" placeholder="Mesaj..."></textarea>
                                    <button onclick="sendAnnouncement()" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg">GÃ¶nder</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-delivery" class="hidden h-full fade-in pb-20">
                    <div class="flex flex-col lg:flex-row gap-6 h-full">
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col p-4 h-64 lg:h-auto">
                            <h3 class="font-bold text-slate-700 mb-4 flex justify-between"><span>Paketler</span><button onclick="createNewDelivery()" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Yeni</button></h3>
                            <div id="deliveryList" class="flex-1 overflow-y-auto space-y-3"></div>
                        </div>
                        <div class="lg:w-2/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col p-6 hidden" id="deliveryDetailPanel">
                            <div class="flex justify-between items-start border-b pb-4 mb-4"><div><h2 class="text-2xl font-bold text-slate-800" id="delDetName">MÃ¼ÅŸteri</h2><p class="text-sm text-slate-500" id="delDetAddress">Adres</p></div><div class="text-right"><span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold" id="delDetStatus">HazÄ±rlanÄ±yor</span></div></div>
                            <div class="flex-1"><ul id="delDetItems" class="space-y-1 text-sm border-b pb-4 mb-4"></ul><div class="flex justify-between items-center"><div class="flex items-center gap-2"><select id="delCourierSelect" class="border rounded p-1 text-sm bg-transparent"></select><button onclick="assignCourier()" class="bg-blue-500 text-white px-3 py-1 rounded text-xs">Ata</button></div><div class="text-xl font-bold" id="delDetTotal">0.00 â‚º</div></div></div>
                            <div class="mt-4 grid grid-cols-2 gap-4"><button onclick="completeDelivery()" class="bg-green-600 text-white py-3 rounded font-bold">Teslim</button><button onclick="cancelDelivery()" class="bg-slate-200 text-slate-700 py-3 rounded font-bold">Ä°ptal</button></div>
                        </div>
                    </div>
                </div>

                <div id="page-kitchen" class="hidden fade-in h-full pb-20">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-700">Mutfak</h3></div>
                    <div id="kitchenGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 overflow-y-auto h-full"></div>
                </div>

                <div id="page-veresiye" class="hidden space-y-6 fade-in pb-20">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"><h3 class="font-bold text-slate-700 mb-4 border-b pb-2">BorÃ§ Ekle</h3><div class="space-y-3"><input id="verName" placeholder="MÃ¼ÅŸteri" class="w-full p-2 border rounded"><input id="verAmount" type="number" placeholder="Tutar" class="w-full p-2 border rounded"><input id="verNote" placeholder="Not" class="w-full p-2 border rounded"><button onclick="addVeresiyeRecord()" class="w-full bg-rose-500 text-white py-2 rounded font-bold">Kaydet</button></div></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col h-96"><h3 class="font-bold text-slate-700 mb-4 flex justify-between"><span>Veresiye</span><span id="totalVeresiye" class="text-rose-600">0 â‚º</span></h3><div id="veresiyeList" class="flex-1 overflow-y-auto space-y-2"></div></div>
                    </div>
                </div>

                <div id="page-finance" class="hidden space-y-6 fade-in pb-20">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">BugÃ¼nÃ¼n Durumu</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-green-50 p-4 rounded-xl border border-green-100"><span class="text-xs font-bold text-green-700">Gelir</span><div class="text-xl font-bold text-green-600 mt-1" id="finTodayIncome">0 â‚º</div></div>
                            <div class="bg-red-50 p-4 rounded-xl border border-red-100"><span class="text-xs font-bold text-red-700">Gider</span><div class="text-xl font-bold text-red-600 mt-1" id="finTodayExpense">0 â‚º</div></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow-sm border"><p class="text-xs font-bold text-slate-400">Ay Gelir</p><h3 class="text-xl font-bold text-green-600" id="finTotalIncome">0 â‚º</h3></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border"><p class="text-xs font-bold text-slate-400">Ay Gider</p><h3 class="text-xl font-bold text-red-600" id="finTotalExpense">0 â‚º</h3></div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-l-4 border-l-indigo-500"><p class="text-xs font-bold text-slate-400">Ay Net</p><h3 class="text-xl font-bold text-indigo-700" id="finNetProfit">0 â‚º</h3></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"><h3 class="font-bold text-slate-700 mb-4 border-b pb-2">HÄ±zlÄ± Gider</h3><div class="flex flex-col gap-3"><div class="flex gap-2"><input type="text" id="expenseDesc" placeholder="AÃ§Ä±klama" class="flex-1 p-2 border rounded"><input type="number" id="expenseAmount" placeholder="Tutar" class="flex-1 p-2 border rounded"><button onclick="addExpense()" class="bg-red-600 text-white px-4 rounded text-sm">Ekle</button></div></div><div class="mt-4 max-h-64 overflow-y-auto space-y-2" id="expenseList"></div></div></div>
                </div>

                <div id="page-stock" class="hidden space-y-6 fade-in pb-20">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 p-6"><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-700">Envanter</h3><button onclick="openStockModal()" class="bg-amber-500 text-white px-3 py-1 rounded text-xs font-bold">Ekle</button></div><div class="overflow-x-auto"><table class="w-full text-left text-sm text-slate-600"><thead class="bg-slate-50 text-xs uppercase"><tr><th class="px-2 py-2">ÃœrÃ¼n</th><th class="px-2 py-2">Miktar</th><th class="px-2 py-2 text-right">Ä°ÅŸlem</th></tr></thead><tbody id="stockTable" class="divide-y divide-slate-100"></tbody></table></div></div></div>
                </div>

                <div id="page-notes" class="hidden space-y-6 fade-in pb-20">
                    <div class="flex justify-between items-center"><h3 class="font-bold text-slate-700 text-xl">ðŸ“Œ Pano</h3><button onclick="addNote()" class="bg-yellow-400 text-yellow-900 px-4 py-2 rounded-lg font-bold shadow">Not YapÄ±ÅŸtÄ±r</button></div><div id="notesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
                </div>

            </main>
        </div>

        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-lg h-[80vh] flex flex-col">
                <div class="flex justify-between items-center p-6 border-b dark:border-slate-700"><h3 class="font-bold text-xl dark:text-white">Ayarlar</h3><button onclick="closeSettings()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button></div>
                <div class="flex-1 overflow-y-auto p-6 space-y-6 dark:text-slate-300">
                    <section>
                        <h4 class="font-bold text-indigo-600 border-b pb-2 mb-3">Ä°ÅŸletme</h4>
                        <div class="grid grid-cols-1 gap-3">
                            <input type="text" id="settingName" class="border p-2 rounded bg-transparent" placeholder="Ä°ÅŸletme AdÄ±">
                            <input type="number" id="settingLimit" class="border p-2 rounded bg-transparent" placeholder="Puan Limiti">
                            <input type="text" id="settingReward" class="border p-2 rounded bg-transparent" placeholder="Ã–dÃ¼l AdÄ±">
                        </div>
                    </section>
                    <section>
                        <h4 class="font-bold text-orange-600 border-b pb-2 mb-3">Masalar</h4>
                        <div class="flex gap-2 mb-3"><input id="newTableName" placeholder="Masa AdÄ±" class="flex-1 border p-2 rounded bg-transparent"><button onclick="addTable()" class="bg-orange-600 text-white px-4 rounded font-bold">Ekle</button></div>
                        <div id="settingsTableList" class="bg-slate-50 dark:bg-slate-700 p-2 rounded max-h-32 overflow-y-auto space-y-1"></div>
                    </section>
                    <section>
                        <h4 class="font-bold text-green-600 border-b pb-2 mb-3">MenÃ¼</h4>
                        <div class="flex gap-2 mb-3"><input id="newProdName" placeholder="ÃœrÃ¼n" class="flex-1 border p-2 rounded bg-transparent"><input id="newProdPrice" type="number" placeholder="Fiyat" class="w-20 border p-2 rounded bg-transparent"><button onclick="addProduct()" class="bg-green-600 text-white px-3 rounded font-bold">Ekle</button></div>
                        <div id="settingsProductList" class="bg-slate-50 dark:bg-slate-700 p-2 rounded max-h-32 overflow-y-auto space-y-1"></div>
                    </section>
                    <section>
                        <h4 class="font-bold text-blue-600 border-b pb-2 mb-3">Yedekleme</h4>
                        <div class="grid grid-cols-1 gap-2">
                            <button onclick="exportFinanceToExcel()" class="bg-green-600 text-white py-2 rounded text-sm">Excel Rapor Ä°ndir</button>
                            <button onclick="exportData()" class="bg-blue-100 text-blue-700 py-2 rounded text-sm">Yedek Ä°ndir</button>
                            <button onclick="importDataTrigger()" class="bg-slate-100 text-slate-700 py-2 rounded text-sm">Yedek YÃ¼kle</button>
                            <input type="file" id="importFile" class="hidden" onchange="importData(this)">
                        </div>
                    </section>
                    <div class="pt-4 border-t"><button onclick="saveSettings()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg">Kaydet</button></div>
                </div>
            </div>
        </div>

        <div id="stockModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white dark:bg-slate-800 rounded-xl p-6 w-80">
                <h3 class="font-bold mb-4 dark:text-white">Stok Ekle</h3>
                <div class="space-y-3">
                    <input id="stkName" placeholder="ÃœrÃ¼n" class="w-full p-2 border rounded bg-transparent dark:text-white">
                    <input id="stkQty" type="number" placeholder="Miktar" class="w-full p-2 border rounded bg-transparent dark:text-white">
                    <input id="stkUnit" placeholder="Birim" class="w-full p-2 border rounded bg-transparent dark:text-white">
                    <input id="stkCrit" type="number" placeholder="Kritik SÄ±nÄ±r" class="w-full p-2 border rounded bg-transparent dark:text-white">
                    <div class="flex gap-2 mt-4"><button onclick="saveStockItem()" class="flex-1 bg-amber-500 text-white py-2 rounded font-bold">Kaydet</button><button onclick="document.getElementById('stockModal').classList.add('hidden')" class="flex-1 bg-slate-200 text-slate-700 py-2 rounded font-bold">Ä°ptal</button></div>
                </div>
            </div>
        </div>

        <script>
            // --- MOBÄ°L MENÃœ KONTROL ---
            function toggleMenu() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobile-overlay');
                
                if (sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.remove('-translate-x-full'); // MenÃ¼yÃ¼ aÃ§
                    overlay.classList.remove('hidden'); // ArkaplanÄ± karart
                } else {
                    sidebar.classList.add('-translate-x-full'); // MenÃ¼yÃ¼ kapat
                    overlay.classList.add('hidden'); // ArkaplanÄ± aÃ§
                }
            }

            // Sayfa deÄŸiÅŸince mobilde menÃ¼yÃ¼ otomatik kapat
            function sayfaDegistir(id) {
                document.querySelectorAll('main > div').forEach(e => e.classList.add('hidden'));
                const target = document.getElementById(`page-${id}`);
                if(target) target.classList.remove('hidden');
                
                // MenÃ¼ aktiflik durumu
                document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('bg-slate-800', 'text-white'); el.classList.add('text-slate-300'); });
                const activeLinks = document.querySelectorAll(`.nav-item`);
                activeLinks.forEach(link => { if(link.getAttribute('onclick').includes(id)) { link.classList.add('bg-slate-800', 'text-white'); link.classList.remove('text-slate-300'); }});

                if(window.innerWidth < 1024) { // Sadece mobilde kapat
                    document.getElementById('sidebar').classList.add('-translate-x-full');
                    document.getElementById('mobile-overlay').classList.add('hidden');
                }

                // Sayfa Ã¶zel fonksiyonlarÄ±
                if(id === 'dashboard') renderDashboard();
                if(id === 'pos') { renderTables(); }
                if(id === 'customer') { renderCustomerTable(); }
                if(id === 'finance') renderFinanceDashboard();
                if(id === 'kitchen') renderKitchen();
                if(id === 'stock') { renderStock(); renderSuppliers(); }
                if(id === 'notes') renderNotes();
                if(id === 'delivery') renderDeliveries();
                if(id === 'veresiye') renderVeresiye();
                if(id === 'marketing') renderMarketingList();
            }

            // --- YAPILANDIRMA ---
            const ADMIN_USER = "5437485476";
            const ADMIN_PASS = "N_rlozk1234";

            const DB_KEY = 'esnaf_pro_cust_v17';
            const SALES_KEY = 'esnaf_pro_sales_v17';
            const PROD_KEY = 'esnaf_pro_prod_v17';
            const TABLES_KEY = 'esnaf_pro_tables_v17';
            const EXP_KEY = 'esnaf_pro_exp_v17';
            const STOCK_KEY = 'esnaf_pro_stk_v17';
            const NOTES_KEY = 'esnaf_pro_notes_v17';
            const DEL_KEY = 'esnaf_pro_del_v17';
            const SUPP_KEY = 'esnaf_pro_supp_v17';
            const VERESIYE_KEY = 'esnaf_pro_ver_v17';
            const SETTINGS_KEY = 'esnaf_pro_set_v17';
            
            let settings = { businessName: "Cadde Hot Dog", pointLimit: 100, reward: "SÃ¼rpriz Hediye" };
            let activeTables = []; let activeTableId = null; let activeDeliveryId = null;

            document.addEventListener('DOMContentLoaded', () => {
                checkAutoLogin();
                if(localStorage.getItem('darkMode') === 'true') document.documentElement.classList.add('dark');
            });

            // --- GÄ°RÄ°Åž SÄ°STEMÄ° ---
            function checkAutoLogin() { if (localStorage.getItem('esnafPro_auth') === 'true' || sessionStorage.getItem('esnafPro_auth') === 'true') { showApp(); } }
            function checkLogin() { const u = document.getElementById('loginUser').value; const p = document.getElementById('loginPass').value; const rem = document.getElementById('rememberMe').checked; if (u === ADMIN_USER && p === ADMIN_PASS) { if (rem) localStorage.setItem('esnafPro_auth', 'true'); else sessionStorage.setItem('esnafPro_auth', 'true'); showApp(); } else { document.getElementById('loginError').classList.remove('hidden'); } }
            function showApp() { document.getElementById('login-container').classList.add('hidden'); document.getElementById('app-container').classList.remove('hidden'); loadSettings(); initTables(); renderDashboard(); checkAlerts(); setInterval(renderKitchen, 30000); }
            function doLogout() { localStorage.removeItem('esnafPro_auth'); sessionStorage.removeItem('esnafPro_auth'); location.reload(); }

            function getStorage(key) { return JSON.parse(localStorage.getItem(key)) || []; }
            function setStorage(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
            function toggleDarkMode() { document.documentElement.classList.toggle('dark'); localStorage.setItem('darkMode', document.documentElement.classList.contains('dark')); }

            // --- EXCEL CIKTISI ---
            function exportFinanceToExcel() {
                const sales = getStorage(SALES_KEY);
                const expenses = getStorage(EXP_KEY);
                let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
                
                let dailyStats = {};
                sales.forEach(s => { let dateKey = new Date(s.date).toLocaleDateString(); if(!dailyStats[dateKey]) dailyStats[dateKey] = {income:0, expense:0}; dailyStats[dateKey].income += s.total; });
                expenses.forEach(e => { let dateKey = new Date(e.date).toLocaleDateString(); if(!dailyStats[dateKey]) dailyStats[dateKey] = {income:0, expense:0}; dailyStats[dateKey].expense += e.amount; });

                csvContent += "GUNLUK OZET RAPORU\n";
                csvContent += "Tarih;Toplam Gelir;Toplam Gider;Net Kar\n";
                Object.keys(dailyStats).sort().reverse().forEach(date => { let d = dailyStats[date]; let net = d.income - d.expense; csvContent += `${date};${d.income};${d.expense};${net}\n`; });
                csvContent += "\n\n"; 

                csvContent += "GIDER LISTESI (Harcamalar)\n";
                csvContent += "Tarih;Aciklama;Tutar (TL)\n";
                expenses.forEach(e => { let date = new Date(e.date).toLocaleDateString(); let desc = e.desc.replace(/;/g, " "); csvContent += `${date};${desc};-${e.amount}\n`; });
                csvContent += "\n\n";

                csvContent += "GELIR LISTESI (Satislar)\n";
                csvContent += "Tarih;Aciklama;Tutar (TL)\n";
                sales.forEach(s => { let date = new Date(s.date).toLocaleDateString(); let desc = s.tableName.replace(/;/g, " "); csvContent += `${date};${desc};${s.total}\n`; });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "EsnafPro_Detayli_Finans_Raporu_" + new Date().toLocaleDateString() + ".csv");
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            }

            function renderFinanceDashboard() { 
                const sales = getStorage(SALES_KEY); const exps = getStorage(EXP_KEY); 
                let inc=0, exp=0; let todayInc=0, todayExp=0; 
                const todayStart = new Date().setHours(0,0,0,0);
                sales.forEach(s => { inc += s.total; if(s.date >= todayStart) todayInc += s.total; }); 
                exps.forEach(e => { exp += e.amount; if(e.date >= todayStart) todayExp += e.amount; }); 
                
                document.getElementById('finTodayIncome').innerText = todayInc.toFixed(2) + " â‚º";
                document.getElementById('finTodayExpense').innerText = todayExp.toFixed(2) + " â‚º";
                document.getElementById('finTotalIncome').innerText = inc.toFixed(2) + " â‚º"; 
                document.getElementById('finTotalExpense').innerText = exp.toFixed(2) + " â‚º"; 
                document.getElementById('finNetProfit').innerText = (inc - exp).toFixed(2) + " â‚º"; 
                
                const elist = document.getElementById('expenseList'); elist.innerHTML = ''; 
                exps.slice(-5).reverse().forEach(e => { let dateStr = new Date(e.date).toLocaleDateString('tr-TR'); elist.innerHTML += `<div class="flex justify-between items-center border-b pb-2 mb-2 dark:border-slate-700"><div class="flex flex-col"><span class="text-sm font-bold text-slate-700 dark:text-slate-200">${e.desc}</span><span class="text-xs text-slate-400"><i class="fa-regular fa-clock mr-1"></i>${dateStr}</span></div><span class="text-red-600 font-bold">-${e.amount} â‚º</span></div>`; }); 
            }

            function islemYap() {
                const telInput = document.getElementById('mainInput'); const nameInput = document.getElementById('mainName');
                let tel = telInput.value.replace(/\D/g, ''); let name = nameInput.value.trim();
                if (tel.length < 10) { alert("LÃ¼tfen 10 haneli numara girin."); return; }
                if (tel.startsWith('0')) tel = tel.substring(1);
                let db = getStorage(DB_KEY); let customer = db.find(c => c.tel === tel); let puan = 0; let message = "";
                let dukkanIsmi = settings.businessName || "Ä°ÅŸletmemiz";
                let odulAdi = settings.reward || "SÃ¼rpriz Hediye";

                if (customer) { 
                    if(name) customer.name = name; 
                    customer.points += 10; customer.visits += 1; customer.lastVisit = Date.now(); puan = customer.points; 
                    message = `SayÄ±n ${customer.name || 'MÃ¼ÅŸterimiz'}, ${dukkanIsmi} olarak bizi tercih ettiÄŸiniz iÃ§in teÅŸekkÃ¼rler! PuanÄ±nÄ±z: ${puan}.`; 
                    if(puan >= settings.pointLimit) message = `Tebrikler SayÄ±n ${customer.name || 'MÃ¼ÅŸterimiz'}! ${dukkanIsmi} Ã¼yeliÄŸinizde ${puan} puana ulaÅŸtÄ±nÄ±z. ðŸŽ **${odulAdi}** kazandÄ±nÄ±z! Kasadan alabilirsiniz.`; 
                } else { 
                    customer = { id: Date.now(), tel: tel, name: name || "DeÄŸerli MÃ¼ÅŸterimiz", points: 10, visits: 1, firstVisit: Date.now(), lastVisit: Date.now() }; db.push(customer); 
                    message = `HoÅŸ geldiniz! ${dukkanIsmi} sadakat sistemine kaydÄ±nÄ±z yapÄ±ldÄ±. Ä°lk 10 puanÄ±nÄ±z yÃ¼klendi!`; 
                }
                setStorage(DB_KEY, db); telInput.value = ''; nameInput.value = ''; renderCustomerTable();
                if(confirm("Puan kaydedildi! WhatsApp mesajÄ± gÃ¶nderilsin mi?")) { window.open(`https://wa.me/90${tel}?text=${encodeURIComponent(message)}`, '_blank'); }
            }

            function resetPoints(tel) {
                if(confirm("Bu mÃ¼ÅŸterinin puanÄ± sÄ±fÄ±rlansÄ±n mÄ±? (Ã–dÃ¼l verildiÄŸinde kullanÄ±lÄ±r)")) {
                    let db = getStorage(DB_KEY);
                    let c = db.find(x => x.tel === tel);
                    if(c) { c.points = 0; setStorage(DB_KEY, db); renderCustomerTable(); alert("Puan sÄ±fÄ±rlandÄ±."); }
                }
            }

            function renderCustomerTable() { 
                const db = getStorage(DB_KEY); const table = document.getElementById('transactionTable'); const search = document.getElementById('customerSearch').value.toLowerCase(); table.innerHTML = ''; 
                const filtered = db.filter(c => (c.name && c.name.toLowerCase().includes(search)) || (c.tel && c.tel.includes(search))); 
                filtered.reverse().forEach((c) => { 
                    table.innerHTML += `<tr class='border-b hover:bg-slate-50 transition'><td class='px-4 py-3 font-medium text-slate-700'>${c.name}</td><td class='px-4 py-3 text-slate-500 font-mono'>${c.tel}</td><td class='px-4 py-3 font-bold text-indigo-600'>${c.points}</td><td class='px-4 py-3 text-right'><button onclick="resetPoints('${c.tel}')" class="text-orange-500 hover:text-orange-700 px-2"><i class="fa-solid fa-arrows-rotate"></i></button><button onclick="delCust('${c.tel}')" class="text-red-400 hover:text-red-600 px-2"><i class="fa-solid fa-trash"></i></button></td></tr>`; 
                }); 
            }

            function renderMarketingList() { const db = getStorage(DB_KEY); const list = document.getElementById('marketingCustomerList'); const search = document.getElementById('marketingSearch').value.toLowerCase(); list.innerHTML = ''; const filtered = db.filter(c => (c.name && c.name.toLowerCase().includes(search)) || (c.tel && c.tel.includes(search))); if(filtered.length === 0) { list.innerHTML = '<div class="text-center text-xs text-slate-400 mt-4">MÃ¼ÅŸteri yok.</div>'; return; } filtered.forEach(c => { list.innerHTML += `<div onclick="selectMarketingTarget('${c.tel}', '${c.name}')" class="p-3 border rounded-lg cursor-pointer hover:bg-indigo-50 bg-white"><div class="font-bold text-sm text-slate-700">${c.name}</div><div class="text-xs text-slate-400">${c.tel}</div></div>`; }); }
            function selectMarketingTarget(tel, name) { document.getElementById('targetCustomerDisplay').value = `${name} (${tel})`; }
            function sendAnnouncement() { const inputVal = document.getElementById('targetCustomerDisplay').value; const msg = document.getElementById('marketingMsgArea').value; if(!inputVal || !msg) { alert("Eksik bilgi."); return; } let tel = ""; const match = inputVal.match(/\((\d+)\)/); if (match) tel = match[1]; else tel = inputVal.replace(/\D/g, ''); if(tel.length < 10) { alert("GeÃ§ersiz numara."); return; } if(tel.startsWith('0')) tel = tel.substring(1); window.open(`https://wa.me/90${tel}?text=${encodeURIComponent(msg)}`, '_blank'); }
            function renderSettingsLists(){ const pl=document.getElementById('settingsProductList'); pl.innerHTML=''; getStorage(PROD_KEY).forEach(p=>{ pl.innerHTML+=`<div class='flex justify-between border-b dark:border-slate-600 p-1 text-sm'><span>${p.name}</span><span>${p.price}â‚º</span></div>`}); const tl=document.getElementById('settingsTableList'); tl.innerHTML=''; getStorage(TABLES_KEY).forEach((t, idx)=>{ tl.innerHTML+=`<div class='flex justify-between border-b dark:border-slate-600 p-1 text-sm'><span>${t.name}</span><button onclick="delTable(${idx})" class="text-red-500 text-xs">Sil</button></div>` }); }
            function addTable() { const n = document.getElementById('newTableName').value; if(n) { const t = getStorage(TABLES_KEY); t.push({id: Date.now(), name: n, items: [], total: 0}); setStorage(TABLES_KEY, t); document.getElementById('newTableName').value = ''; renderSettingsLists(); initTables(); } }
            function delTable(idx) { if(confirm("Silinsin mi?")) { const t = getStorage(TABLES_KEY); if(t[idx].total > 0) { alert("Masa dolu."); return; } t.splice(idx, 1); setStorage(TABLES_KEY, t); renderSettingsLists(); initTables(); } }
            function exportData() { const data = { customers: getStorage(DB_KEY), sales: getStorage(SALES_KEY), products: getStorage(PROD_KEY), tables: getStorage(TABLES_KEY), expenses: getStorage(EXP_KEY), stock: getStorage(STOCK_KEY), veresiye: getStorage(VERESIYE_KEY), settings: settings }; const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data)); const a = document.createElement('a'); a.href = dataStr; a.download = "esnafpro_yedek.json"; document.body.appendChild(a); a.click(); a.remove(); }
            function importDataTrigger() { document.getElementById('importFile').click(); }
            function importData(input) { const file = input.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const data = JSON.parse(e.target.result); if(data.customers) setStorage(DB_KEY, data.customers); if(data.sales) setStorage(SALES_KEY, data.sales); if(data.products) setStorage(PROD_KEY, data.products); if(data.tables) setStorage(TABLES_KEY, data.tables); if(data.expenses) setStorage(EXP_KEY, data.expenses); if(data.stock) setStorage(STOCK_KEY, data.stock); if(data.veresiye) setStorage(VERESIYE_KEY, data.veresiye); if(data.settings) localStorage.setItem(SETTINGS_KEY, JSON.stringify(data.settings)); alert("YÃ¼klendi!"); location.reload(); } catch(err) { alert("Hata."); } }; reader.readAsText(file); }
            function renderDashboard() { const sales = getStorage(SALES_KEY); const customers = getStorage(DB_KEY); const todayStart = new Date().setHours(0,0,0,0); let dTotal=0, delCount=0; sales.forEach(s => { if(s.date >= todayStart) { dTotal += s.total; if(s.type === 'Paket') delCount++; } }); let activeTbl = getStorage(TABLES_KEY).filter(t => t.total > 0).length; document.getElementById('statDailyRevenue').innerText = dTotal.toFixed(2) + " â‚º"; document.getElementById('statDeliveryCount').innerText = delCount; document.getElementById('statActiveTables').innerText = activeTbl; document.getElementById('statTotalCustomers').innerText = customers.length; const tbl = document.getElementById('dashboardSalesTable'); tbl.innerHTML = ''; sales.slice(-5).reverse().forEach(s => { tbl.innerHTML += `<tr class='border-b hover:bg-slate-50 dark:hover:bg-slate-800'><td class='px-4 py-2 text-xs'>${new Date(s.date).toLocaleTimeString()}</td><td class='px-4 py-2 text-xs'>${s.type || 'Masa'}</td><td class='px-4 py-2 font-bold text-slate-700 dark:text-slate-300'>${s.total}â‚º</td></tr>`; }); const notes = getStorage(NOTES_KEY); const noteBox = document.getElementById('dashNotes'); noteBox.innerHTML = ''; if(notes.length > 0) { notes.slice(0,3).forEach(n => noteBox.innerHTML += `<div class="bg-yellow-50 border border-yellow-200 p-2 rounded text-xs text-yellow-800">${n.text}</div>`); } else noteBox.innerHTML = '<p class="text-xs text-slate-400 italic">HenÃ¼z not yok.</p>'; }
            function initTables() { activeTables = getStorage(TABLES_KEY); if(activeTables.length === 0) { for(let i=1; i<=6; i++) activeTables.push({ id: Date.now()+i, name: `Masa ${i}`, items: [], total: 0 }); setStorage(TABLES_KEY, activeTables); } renderTables(); }
            function renderTables() { const grid = document.getElementById('tablesGrid'); grid.innerHTML = ''; activeTables.forEach(t => { const filled = t.items.length > 0; grid.innerHTML += `<button onclick="selectTable(${t.id})" class="${filled?'bg-red-50 border-red-200 dark:bg-red-900 dark:border-red-700':'bg-emerald-50 border-emerald-200 dark:bg-emerald-900 dark:border-emerald-700'} border rounded-xl p-3 flex flex-col items-center justify-center h-20 shadow-sm relative transition active:scale-95 ${activeTableId===t.id?'ring-2 ring-indigo-500':''}"> <span class="font-bold text-slate-700 dark:text-white text-sm">${t.name}</span>${filled?`<span class="text-xs font-bold text-red-600 bg-white px-2 py-1 rounded mt-1 shadow-sm">${t.total} â‚º</span>`:''} </button>`; }); }
            function selectTable(id) { activeTableId = id; activeDeliveryId = null; renderTables(); const table = activeTables.find(t=>t.id===id); document.getElementById('selectedTableName').innerText = table.name; document.getElementById('productSection').classList.remove('opacity-50','pointer-events-none'); document.getElementById('orderSection').classList.remove('opacity-50','pointer-events-none'); renderProducts(); renderCurrentOrder(); }
            function renderProducts() { const list = getStorage(PROD_KEY); const grid = document.getElementById('productsGrid'); grid.innerHTML = ''; const filter = document.getElementById('searchProduct').value.toLowerCase(); list.filter(p=>p.name.toLowerCase().includes(filter)).forEach(p=>{ grid.innerHTML += `<div onclick="addToOrder(${p.id},'${p.name}',${p.price})" class="cursor-pointer bg-white dark:bg-slate-700 border dark:border-slate-600 hover:bg-indigo-50 dark:hover:bg-slate-600 p-2 rounded shadow-sm h-16 flex flex-col justify-center"><span class="text-xs font-bold leading-tight dark:text-white">${p.name}</span><span class="text-green-600 dark:text-green-400 text-xs font-bold">${p.price} â‚º</span></div>`; }); }
            function filterProducts() { renderProducts(); }
            function addToOrder(id, name, price) { if(!activeTableId) return; const table = activeTables.find(t=>t.id===activeTableId); const ex = table.items.find(i=>i.id===id); if(ex) ex.qty++; else table.items.push({id,name,price,qty:1}); table.total = table.items.reduce((a,b)=>a+(b.price*b.qty),0); renderCurrentOrder(); renderTables(); }
            function renderCurrentOrder() { const table = activeTables.find(t=>t.id===activeTableId); const list = document.getElementById('currentOrderList'); list.innerHTML = ''; table.items.forEach((i,idx)=>{ list.innerHTML += `<li class="flex justify-between text-sm border-b pb-1 dark:border-slate-700 dark:text-slate-300"><span>${i.qty}x ${i.name}</span><button onclick="remItem(${idx})" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button></li>`; }); document.getElementById('orderTotal').innerText = table.total.toFixed(2) + " â‚º"; }
            function remItem(idx) { const table = activeTables.find(t=>t.id===activeTableId); table.items.splice(idx,1); table.total = table.items.reduce((a,b)=>a+(b.price*b.qty),0); renderCurrentOrder(); renderTables(); }
            function clearCurrentOrder() { if(confirm("Temizle?")) { const t=activeTables.find(x=>x.id===activeTableId); t.items=[]; t.total=0; renderCurrentOrder(); renderTables(); } }
            function completePayment(method) { const table = activeTables.find(t=>t.id===activeTableId); if(table.total===0) return; const sale = { id:Date.now(), date:Date.now(), tableName:table.name, items:[...table.items], total:table.total, paymentMethod:method, type: 'Masa' }; const sales = getStorage(SALES_KEY); sales.push(sale); setStorage(SALES_KEY, sales); table.items=[]; table.total=0; renderCurrentOrder(); renderTables(); alert("Ã–deme AlÄ±ndÄ±!"); }
            function sendToKitchen() { alert("Mutfak ekranÄ±na gÃ¶nderildi."); renderKitchen(); }
            function delCust(tel) { if(confirm("Silinsin mi?")) { let db=getStorage(DB_KEY); db=db.filter(c=>c.tel!==tel); setStorage(DB_KEY,db); renderCustomerTable(); } }
            function createNewDelivery() { const name = prompt("MÃ¼ÅŸteri AdÄ±:"); const addr = prompt("Adres:"); if(name && addr) { const dels = getStorage(DEL_KEY); const newDel = { id:Date.now(), customerName:name, address:addr, items:[], total:0, status: 'HazÄ±rlanÄ±yor', courier: '' }; dels.push(newDel); setStorage(DEL_KEY, dels); renderDeliveries(); selectDelivery(newDel.id); } }
            function selectDelivery(id) { activeDeliveryId = id; activeTableId = null; const dels = getStorage(DEL_KEY); const d = dels.find(x => x.id === id); document.getElementById('deliveryDetailPanel').classList.remove('hidden'); document.getElementById('delDetName').innerText = d.customerName; document.getElementById('delDetAddress').innerText = d.address; document.getElementById('delDetStatus').innerText = d.status; document.getElementById('delDetTotal').innerText = d.total + " â‚º"; const ul = document.getElementById('delDetItems'); ul.innerHTML = ''; if(d.items.length===0) ul.innerHTML = '<li class="text-slate-400 italic">ÃœrÃ¼n eklemek iÃ§in POS ekranÄ±nÄ± kullanÄ±n (Demo)</li>'; else d.items.forEach(i => ul.innerHTML += `<li>${i.qty}x ${i.name}</li>`); const sel = document.getElementById('delCourierSelect'); sel.innerHTML = '<option value="">SeÃ§</option><option value="Ahmet">Ahmet</option><option value="Mehmet">Mehmet</option>'; sel.value = d.courier; renderDeliveries(); }
            function assignCourier() { if(!activeDeliveryId) return; const c = document.getElementById('delCourierSelect').value; const dels = getStorage(DEL_KEY); const d = dels.find(x => x.id === activeDeliveryId); d.courier = c; d.status = 'Yolda'; setStorage(DEL_KEY, dels); renderDeliveries(); selectDelivery(d.id); }
            function completeDelivery() { if(!activeDeliveryId) return; if(!confirm("Teslim edildi ve Ã¼cret alÄ±ndÄ± mÄ±?")) return; const dels = getStorage(DEL_KEY); const idx = dels.findIndex(x => x.id === activeDeliveryId); const d = dels[idx]; const sales = getStorage(SALES_KEY); sales.push({ id:Date.now(), date:Date.now(), tableName:'Paket: '+d.customerName, items:d.items, total:d.total, paymentMethod:'Nakit', type: 'Paket' }); setStorage(SALES_KEY, sales); dels.splice(idx, 1); setStorage(DEL_KEY, dels); document.getElementById('deliveryDetailPanel').classList.add('hidden'); activeDeliveryId = null; renderDeliveries(); }
            function addVeresiyeRecord() { const n=document.getElementById('verName').value, a=parseFloat(document.getElementById('verAmount').value), no=document.getElementById('verNote').value; if(n && a) { const list = getStorage(VERESIYE_KEY); list.push({date:Date.now(), name:n, amount:a, note:no}); setStorage(VERESIYE_KEY, list); document.getElementById('verName').value=''; document.getElementById('verAmount').value=''; renderVeresiye(); } }
            function payVeresiye(idx) { if(confirm("BorÃ§ silinsin mi?")) { const list = getStorage(VERESIYE_KEY); list.splice(idx,1); setStorage(VERESIYE_KEY, list); renderVeresiye(); } }
            function addVeresiye() { const table = activeTables.find(t=>t.id===activeTableId); if(table.total === 0) return; const name = prompt("MÃ¼ÅŸteri AdÄ±:"); if(name) { const list = getStorage(VERESIYE_KEY); list.push({date:Date.now(), name:name, amount:table.total, note:"Masa HesabÄ±"}); setStorage(VERESIYE_KEY, list); table.items=[]; table.total=0; renderCurrentOrder(); renderTables(); renderVeresiye(); alert("Veresiye defterine iÅŸlendi."); } }
            function renderSuppliers() { const s = getStorage(SUPP_KEY); const el = document.getElementById('supplierList'); el.innerHTML = ''; s.forEach((item, idx) => { el.innerHTML += `<div class="flex justify-between text-sm border-b p-1 dark:text-slate-300 dark:border-slate-700"><span>${item.name} (${item.tel})</span><button onclick="delSupp(${idx})" class="text-red-400"><i class="fa-solid fa-trash"></i></button></div>`; }); }
            function addSupplier() { const n=document.getElementById('suppName').value, t=document.getElementById('suppTel').value; if(n) { const s=getStorage(SUPP_KEY); s.push({name:n, tel:t}); setStorage(SUPP_KEY,s); renderSuppliers(); } }
            function delSupp(idx) { const s=getStorage(SUPP_KEY); s.splice(idx,1); setStorage(SUPP_KEY,s); renderSuppliers(); }
            function openStockModal() { document.getElementById('stockModal').classList.remove('hidden'); }
            function saveStockItem() { const name = document.getElementById('stkName').value; const qty = parseFloat(document.getElementById('stkQty').value); const unit = document.getElementById('stkUnit').value; const crit = parseFloat(document.getElementById('stkCrit').value); if(name && !isNaN(qty)) { const s = getStorage(STOCK_KEY); s.push({id:Date.now(), name, qty, unit, crit}); setStorage(STOCK_KEY, s); document.getElementById('stockModal').classList.add('hidden'); renderStock(); } }
            function renderStock() { const s = getStorage(STOCK_KEY); const tbl = document.getElementById('stockTable'); tbl.innerHTML = ''; s.forEach((item, idx) => { const isCrit = item.qty <= item.crit; tbl.innerHTML += `<tr class="border-b dark:border-slate-700 dark:text-slate-300 ${isCrit ? 'bg-red-50 dark:bg-red-900/20' : ''}"><td class="px-2 py-2 font-bold">${item.name}</td><td class="px-2 py-2 ${isCrit ? 'text-red-600 font-bold' : ''}">${item.qty}</td><td class="px-2 py-2 text-right"><button onclick="updateStock(${idx}, 1)" class="text-green-500 px-1">+</button><button onclick="updateStock(${idx}, -1)" class="text-red-500 px-1">-</button></td></tr>`; }); checkAlerts(); }
            function updateStock(idx, val) { const s=getStorage(STOCK_KEY); s[idx].qty += val; setStorage(STOCK_KEY, s); renderStock(); }
            function checkAlerts() { const s = getStorage(STOCK_KEY); const crit = s.some(i => i.qty <= i.crit); if(crit) document.getElementById('stockAlert').classList.remove('hidden'); else document.getElementById('stockAlert').classList.add('hidden'); }
            function renderKitchen() { const grid = document.getElementById('kitchenGrid'); grid.innerHTML = ''; const tables = getStorage(TABLES_KEY).filter(t => t.items.length > 0); if(tables.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-slate-400 mt-10">SipariÅŸ yok.</div>`; return; } tables.forEach(t => { let itemsHtml = t.items.map(i => `<div class="flex justify-between border-b dark:border-slate-600 py-1"><span>${i.qty}x ${i.name}</span></div>`).join(''); grid.innerHTML += `<div class="bg-white dark:bg-slate-800 border-l-4 border-l-orange-500 rounded-lg shadow-md p-4"><div class="font-bold text-lg dark:text-white mb-2">${t.name}</div><div class="text-sm dark:text-slate-300 mb-4">${itemsHtml}</div><button class="w-full bg-green-500 text-white py-1 rounded">HazÄ±r</button></div>`; }); }
            function renderNotes() { const notes = getStorage(NOTES_KEY); const grid = document.getElementById('notesGrid'); grid.innerHTML = ''; const colors = ['bg-yellow-100 text-yellow-800', 'bg-blue-100 text-blue-800', 'bg-pink-100 text-pink-800', 'bg-green-100 text-green-800']; notes.forEach((n, idx) => { const color = colors[idx % colors.length]; grid.innerHTML += `<div class="${color} p-4 rounded shadow-md relative transform hover:-rotate-1 transition duration-300 h-40 flex flex-col"><div class="flex-1 font-handwriting text-lg leading-tight overflow-y-auto">${n.text}</div><div class="text-right mt-2"><button onclick="delNote(${idx})" class="text-xs font-bold opacity-50 hover:opacity-100"><i class="fa-solid fa-trash"></i> YÄ±rt At</button></div></div>`; }); }
            function addNote() { const t = prompt("Notunuz:"); if(t) { const n=getStorage(NOTES_KEY); n.unshift({text:t, date:Date.now()}); setStorage(NOTES_KEY,n); renderNotes(); } }
            function delNote(idx) { const n=getStorage(NOTES_KEY); n.splice(idx,1); setStorage(NOTES_KEY,n); renderNotes(); }
            function addExpense() { const d=document.getElementById('expenseDesc').value, a=parseFloat(document.getElementById('expenseAmount').value); if(d && a) { const e=getStorage(EXP_KEY); e.push({desc:d, amount:a, date:Date.now()}); setStorage(EXP_KEY,e); renderFinanceDashboard(); } }
            function closeSettings(){document.getElementById('settingsModal').classList.add('hidden');}
            function openSettings(){document.getElementById('settingsModal').classList.remove('hidden'); renderSettingsLists();}
            function loadSettings(){ const s=localStorage.getItem(SETTINGS_KEY); if(s) settings=JSON.parse(s); document.getElementById('displayBusinessName').innerText=settings.businessName; document.getElementById('displayBusinessNameDesk').innerText=settings.businessName; document.getElementById('settingName').value=settings.businessName; document.getElementById('settingLimit').value=settings.pointLimit; document.getElementById('settingReward').value=settings.reward || ""; }
            function saveSettings(){ settings.businessName=document.getElementById('settingName').value; settings.pointLimit=document.getElementById('settingLimit').value; settings.reward=document.getElementById('settingReward').value; localStorage.setItem(SETTINGS_KEY,JSON.stringify(settings)); closeSettings(); loadSettings(); }
            function addProduct(){ const n=document.getElementById('newProdName').value, p=document.getElementById('newProdPrice').value; if(n&&p){ const l=getStorage(PROD_KEY); l.push({id:Date.now(),name:n,price:parseFloat(p)}); setStorage(PROD_KEY,l); renderSettingsLists(); } }
            function clearAllData(){ if(confirm("Her ÅŸey silinecek?")) { localStorage.clear(); location.reload(); } }
            function demoVerisiYukle() {
                if(!confirm("Demo verisi yÃ¼klensin mi? TÃ¼m mevcut veriler silinir.")) return;
                localStorage.clear();
                setStorage(PROD_KEY, [{id:1,name:"Sosisli Standart",price:120},{id:2,name:"Mega Burger",price:180},{id:3,name:"Ayran",price:20},{id:4,name:"Kola",price:40},{id:5,name:"Islak Hamburger",price:60}]);
                setStorage(DB_KEY, [{tel:"5551112233", name:"Ali SadÄ±k", points:120, birthday:"2000-01-01", lastVisit: Date.now()}, {tel:"5552223344", name:"AyÅŸe Gezgin", points:40, birthday:"1995-05-12", lastVisit: Date.now()-86400000}]);
                const t = []; for(let i=1;i<=6;i++) t.push({id:i, name:`Masa ${i}`, items:[], total:0});
                t[0].items = [{id:1,name:"Sosisli Standart",qty:2,price:120},{id:4,name:"Kola",qty:2,price:40}]; t[0].total = 320; 
                setStorage(TABLES_KEY, t);
                setStorage(DEL_KEY, [{id:101, customerName:"Mehmet Bey", address:"Ã‡Ä±nar Apt. No:5", items:[{name:"Mega Burger",qty:1}], total:180, status:"Yolda", courier:"Ahmet"}]);
                setStorage(VERESIYE_KEY, [{date:Date.now()-100000, name:"KomÅŸu Berber", amount:250, note:"Ã–ÄŸle YemeÄŸi"}]);
                setStorage(STOCK_KEY, [{id:1, name:"Sosis", qty:5, unit:"Paket", crit:10}, {id:2, name:"Ekmek", qty:100, unit:"Adet", crit:20}]);
                setStorage(SUPP_KEY, [{name:"Kasap Ä°smail", tel:"05321112233"}]);
                setStorage(NOTES_KEY, [{text:"ToptancÄ± yarÄ±n 10'da gelecek, parayÄ± hazÄ±rla.", date:Date.now()}]);
                alert("Demo yÃ¼klendi! DÃ¼kkan canlandÄ±. ðŸš€");
                location.reload();
            }
        </script>
    </div>
</body>
</html>
